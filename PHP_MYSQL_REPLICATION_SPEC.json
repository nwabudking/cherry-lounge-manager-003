{
  "project": {
    "name": "iloungePOS",
    "version": "1.0.0",
    "description": {
      "summary": "A comprehensive, offline-capable Point of Sale (POS) system designed for restaurants, bars, lounges, and hospitality businesses. Built to run entirely on local infrastructure without internet dependency.",
      "key_features": [
        "Complete offline operation - no internet required after deployment",
        "Role-based access control with 7 distinct user roles",
        "Real-time kitchen and bar display systems for order tracking",
        "Comprehensive inventory management with low-stock alerts",
        "Supplier management and stock movement tracking",
        "Detailed sales reports and end-of-day summaries",
        "Multi-payment method support (Cash, Card, Transfer, Mobile)",
        "Customizable receipts with logo and branding",
        "Menu management with categories for food, drinks, and other items",
        "Order types: Dine-in, Takeaway, Delivery, Bar-only",
        "Automatic inventory deduction on order completion",
        "Staff management with password reset capabilities"
      ],
      "target_audience": [
        "Restaurants and Cafes",
        "Bars and Lounges",
        "Hotels and Hospitality",
        "Quick Service Restaurants (QSR)",
        "Food Courts",
        "Catering Services"
      ],
      "benefits": [
        "No recurring cloud subscription fees",
        "Data stays on your premises - full privacy",
        "Works during internet outages",
        "Fast and responsive local network performance",
        "Easy to deploy on WAMP/XAMPP/LAMP stacks",
        "Scalable from single terminal to multi-station setup"
      ],
      "technical_highlights": [
        "UUID-based primary keys for distributed compatibility",
        "JWT-based authentication for secure API access",
        "RESTful API architecture",
        "Audit trails for stock movements",
        "Automatic order number generation with date prefix",
        "Configurable VAT and service charge calculations"
      ]
    },
    "target_platform": "WAMP/XAMPP (Windows) or LAMP (Linux)",
    "technology_stack": {
      "backend": "PHP 8.0+",
      "database": "MySQL 8.0+",
      "frontend": "HTML5, CSS3, JavaScript (or React/Vue optional)",
      "authentication": "JWT or PHP Sessions"
    },
    "license": "Proprietary - Customize as needed"
  },

  "database_schema": {
    "database_name": "iloungepos",
    "charset": "utf8mb4",
    "collation": "utf8mb4_unicode_ci",

    "tables": {
      "users": {
        "description": "Authentication and login credentials",
        "columns": {
          "id": "VARCHAR(36) PRIMARY KEY",
          "email": "VARCHAR(255) NOT NULL UNIQUE",
          "password_hash": "VARCHAR(255) NOT NULL",
          "created_at": "DATETIME DEFAULT CURRENT_TIMESTAMP"
        }
      },

      "profiles": {
        "description": "User profile information",
        "columns": {
          "id": "VARCHAR(36) PRIMARY KEY",
          "email": "VARCHAR(255)",
          "full_name": "VARCHAR(255)",
          "avatar_url": "TEXT NULL",
          "created_at": "DATETIME DEFAULT CURRENT_TIMESTAMP",
          "updated_at": "DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP"
        },
        "foreign_keys": {
          "id": "REFERENCES users(id) ON DELETE CASCADE"
        }
      },

      "user_roles": {
        "description": "Role-based access control - CRITICAL: Keep roles separate from users table",
        "columns": {
          "id": "VARCHAR(36) PRIMARY KEY",
          "user_id": "VARCHAR(36) NOT NULL",
          "role": "ENUM('super_admin', 'manager', 'cashier', 'bar_staff', 'kitchen_staff', 'inventory_officer', 'accountant') DEFAULT 'cashier'",
          "created_at": "DATETIME DEFAULT CURRENT_TIMESTAMP"
        },
        "foreign_keys": {
          "user_id": "REFERENCES users(id) ON DELETE CASCADE"
        }
      },

      "restaurant_settings": {
        "description": "Global business/restaurant configuration - customizable per installation",
        "columns": {
          "id": "VARCHAR(36) PRIMARY KEY",
          "name": "VARCHAR(255) DEFAULT 'My Restaurant'",
          "tagline": "VARCHAR(255) DEFAULT 'Powered by iloungePOS'",
          "address": "TEXT",
          "city": "VARCHAR(100)",
          "country": "VARCHAR(100)",
          "phone": "VARCHAR(50)",
          "email": "VARCHAR(255)",
          "logo_url": "TEXT NULL",
          "currency": "VARCHAR(10) DEFAULT 'USD'",
          "timezone": "VARCHAR(50) DEFAULT 'UTC'",
          "vat_rate": "DECIMAL(5,4) DEFAULT 0.0750",
          "service_charge_rate": "DECIMAL(5,4) DEFAULT 0.1000",
          "receipt_footer": "TEXT DEFAULT 'Thank you for your patronage!'",
          "receipt_show_logo": "BOOLEAN DEFAULT TRUE",
          "created_at": "DATETIME DEFAULT CURRENT_TIMESTAMP",
          "updated_at": "DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP"
        },
        "notes": "VAT and service charge rates are configurable per business requirements"
      },

      "menu_categories": {
        "description": "Categories for menu items - supports food, drink, and other types for kitchen/bar filtering",
        "columns": {
          "id": "VARCHAR(36) PRIMARY KEY",
          "name": "VARCHAR(255) NOT NULL",
          "category_type": "ENUM('food', 'drink', 'other') DEFAULT 'food'",
          "sort_order": "INT DEFAULT 0",
          "is_active": "BOOLEAN DEFAULT TRUE",
          "created_at": "DATETIME DEFAULT CURRENT_TIMESTAMP"
        }
      },

      "suppliers": {
        "description": "Inventory suppliers/vendors for stock management",
        "columns": {
          "id": "VARCHAR(36) PRIMARY KEY",
          "name": "VARCHAR(255) NOT NULL",
          "contact_person": "VARCHAR(255)",
          "phone": "VARCHAR(50)",
          "email": "VARCHAR(255)",
          "address": "TEXT",
          "notes": "TEXT",
          "is_active": "BOOLEAN DEFAULT TRUE",
          "created_at": "DATETIME DEFAULT CURRENT_TIMESTAMP",
          "updated_at": "DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP"
        }
      },

      "inventory_items": {
        "description": "Stock/inventory tracking with minimum level alerts",
        "columns": {
          "id": "VARCHAR(36) PRIMARY KEY",
          "name": "VARCHAR(255) NOT NULL",
          "category": "VARCHAR(100)",
          "category_id": "VARCHAR(36) NULL",
          "unit": "VARCHAR(50) DEFAULT 'pcs'",
          "current_stock": "DECIMAL(10,2) DEFAULT 0",
          "min_stock_level": "DECIMAL(10,2) DEFAULT 5",
          "cost_per_unit": "DECIMAL(10,2)",
          "supplier": "VARCHAR(255)",
          "supplier_id": "VARCHAR(36) NULL",
          "is_active": "BOOLEAN DEFAULT TRUE",
          "created_at": "DATETIME DEFAULT CURRENT_TIMESTAMP",
          "updated_at": "DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP"
        },
        "foreign_keys": {
          "category_id": "REFERENCES menu_categories(id) ON DELETE SET NULL",
          "supplier_id": "REFERENCES suppliers(id) ON DELETE SET NULL"
        }
      },

      "menu_items": {
        "description": "Products available for sale with optional inventory tracking",
        "columns": {
          "id": "VARCHAR(36) PRIMARY KEY",
          "name": "VARCHAR(255) NOT NULL",
          "description": "TEXT",
          "price": "DECIMAL(10,2) NOT NULL",
          "cost_price": "DECIMAL(10,2)",
          "image_url": "TEXT NULL",
          "is_active": "BOOLEAN DEFAULT TRUE",
          "is_available": "BOOLEAN DEFAULT TRUE",
          "category_id": "VARCHAR(36) NULL",
          "inventory_item_id": "VARCHAR(36) NULL",
          "track_inventory": "BOOLEAN DEFAULT FALSE",
          "created_at": "DATETIME DEFAULT CURRENT_TIMESTAMP",
          "updated_at": "DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP"
        },
        "foreign_keys": {
          "category_id": "REFERENCES menu_categories(id) ON DELETE SET NULL",
          "inventory_item_id": "REFERENCES inventory_items(id) ON DELETE SET NULL"
        }
      },

      "orders": {
        "description": "Customer orders with multiple order types",
        "columns": {
          "id": "VARCHAR(36) PRIMARY KEY",
          "order_number": "VARCHAR(50) NOT NULL UNIQUE",
          "order_type": "ENUM('dine_in', 'takeaway', 'delivery', 'bar_only') DEFAULT 'dine_in'",
          "table_number": "VARCHAR(20)",
          "subtotal": "DECIMAL(10,2) DEFAULT 0",
          "vat_amount": "DECIMAL(10,2) DEFAULT 0",
          "service_charge": "DECIMAL(10,2) DEFAULT 0",
          "discount_amount": "DECIMAL(10,2) DEFAULT 0",
          "total_amount": "DECIMAL(10,2) DEFAULT 0",
          "status": "ENUM('pending', 'preparing', 'ready', 'completed', 'cancelled') DEFAULT 'pending'",
          "notes": "TEXT",
          "created_by": "VARCHAR(36)",
          "created_at": "DATETIME DEFAULT CURRENT_TIMESTAMP",
          "updated_at": "DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP"
        }
      },

      "order_items": {
        "description": "Individual items within an order",
        "columns": {
          "id": "VARCHAR(36) PRIMARY KEY",
          "order_id": "VARCHAR(36) NOT NULL",
          "menu_item_id": "VARCHAR(36) NULL",
          "item_name": "VARCHAR(255) NOT NULL",
          "quantity": "INT DEFAULT 1",
          "unit_price": "DECIMAL(10,2) NOT NULL",
          "total_price": "DECIMAL(10,2) NOT NULL",
          "notes": "TEXT",
          "created_at": "DATETIME DEFAULT CURRENT_TIMESTAMP"
        },
        "foreign_keys": {
          "order_id": "REFERENCES orders(id) ON DELETE CASCADE",
          "menu_item_id": "REFERENCES menu_items(id) ON DELETE SET NULL"
        }
      },

      "payments": {
        "description": "Payment records for orders - supports multiple payment methods",
        "columns": {
          "id": "VARCHAR(36) PRIMARY KEY",
          "order_id": "VARCHAR(36) NOT NULL",
          "payment_method": "ENUM('cash', 'card', 'transfer', 'mobile') DEFAULT 'cash'",
          "amount": "DECIMAL(10,2) NOT NULL",
          "reference": "VARCHAR(255)",
          "status": "ENUM('pending', 'completed', 'failed', 'refunded') DEFAULT 'completed'",
          "created_by": "VARCHAR(36)",
          "created_at": "DATETIME DEFAULT CURRENT_TIMESTAMP"
        },
        "foreign_keys": {
          "order_id": "REFERENCES orders(id) ON DELETE CASCADE"
        }
      },

      "stock_movements": {
        "description": "Inventory stock changes audit trail - tracks all stock in/out/adjustments",
        "columns": {
          "id": "VARCHAR(36) PRIMARY KEY",
          "inventory_item_id": "VARCHAR(36) NOT NULL",
          "movement_type": "ENUM('in', 'out', 'adjustment') NOT NULL",
          "quantity": "DECIMAL(10,2) NOT NULL",
          "previous_stock": "DECIMAL(10,2) NOT NULL",
          "new_stock": "DECIMAL(10,2) NOT NULL",
          "notes": "TEXT",
          "reference": "VARCHAR(36)",
          "created_by": "VARCHAR(36)",
          "created_at": "DATETIME DEFAULT CURRENT_TIMESTAMP"
        },
        "foreign_keys": {
          "inventory_item_id": "REFERENCES inventory_items(id) ON DELETE CASCADE"
        }
      }
    },

    "indexes": [
      "CREATE INDEX idx_orders_created_at ON orders(created_at)",
      "CREATE INDEX idx_orders_status ON orders(status)",
      "CREATE INDEX idx_orders_order_type ON orders(order_type)",
      "CREATE INDEX idx_order_items_order_id ON order_items(order_id)",
      "CREATE INDEX idx_payments_order_id ON payments(order_id)",
      "CREATE INDEX idx_stock_movements_item ON stock_movements(inventory_item_id)",
      "CREATE INDEX idx_stock_movements_date ON stock_movements(created_at)",
      "CREATE INDEX idx_menu_items_category ON menu_items(category_id)",
      "CREATE INDEX idx_menu_categories_type ON menu_categories(category_type)",
      "CREATE INDEX idx_inventory_items_stock ON inventory_items(current_stock, min_stock_level)"
    ],

    "stored_procedures": {
      "generate_order_number": {
        "description": "Generate unique order number with date prefix",
        "sql": "CREATE FUNCTION generate_order_number() RETURNS VARCHAR(50) BEGIN DECLARE new_number VARCHAR(50); SET new_number = CONCAT('ORD-', DATE_FORMAT(NOW(), '%Y%m%d'), '-', LPAD(FLOOR(RAND() * 10000), 4, '0')); RETURN new_number; END"
      },
      "get_low_stock_count": {
        "description": "Count items below minimum stock level",
        "sql": "CREATE FUNCTION get_low_stock_count() RETURNS INT BEGIN DECLARE count INT; SELECT COUNT(*) INTO count FROM inventory_items WHERE current_stock <= min_stock_level AND is_active = 1; RETURN count; END"
      }
    }
  },

  "api_endpoints": {
    "authentication": {
      "POST /api/auth/login": {
        "description": "User login with email and password",
        "request_body": {
          "email": "string",
          "password": "string"
        },
        "response": {
          "user": "object (id, email, full_name, role)",
          "access_token": "string (JWT)",
          "refresh_token": "string (JWT)"
        },
        "logic": [
          "1. Validate email exists in users table",
          "2. Verify password using password_verify()",
          "3. Get user role from user_roles table",
          "4. Get profile from profiles table",
          "5. Generate JWT tokens with user data and role",
          "6. Return user data with tokens"
        ]
      },
      "POST /api/auth/register": {
        "description": "Create new user account (used during setup or by admin)",
        "request_body": {
          "email": "string",
          "password": "string",
          "full_name": "string"
        },
        "logic": [
          "1. Check if email already exists",
          "2. Hash password using password_hash() with PASSWORD_DEFAULT",
          "3. Generate UUID for new user",
          "4. Create user record in users table",
          "5. Create profile record in profiles table",
          "6. Assign default role (first user = super_admin, others = cashier)",
          "7. Generate tokens and return"
        ]
      },
      "POST /api/auth/refresh": {
        "description": "Refresh access token using refresh token",
        "request_body": {
          "refresh_token": "string"
        }
      },
      "GET /api/auth/me": {
        "description": "Get current authenticated user profile and role",
        "requires_auth": true,
        "response": {
          "user": "object with profile and role"
        }
      },
      "POST /api/auth/change-password": {
        "description": "Change current user's password",
        "requires_auth": true,
        "request_body": {
          "new_password": "string"
        }
      }
    },

    "menu": {
      "GET /api/menu/categories": {
        "description": "Get all menu categories with optional filtering",
        "requires_auth": true,
        "query_params": {
          "active_only": "boolean (optional, default: false)",
          "category_type": "food|drink|other (optional)"
        }
      },
      "POST /api/menu/categories": {
        "description": "Create new category",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager"],
        "request_body": {
          "name": "string",
          "category_type": "food|drink|other",
          "sort_order": "number (optional)"
        }
      },
      "PATCH /api/menu/categories/:id": {
        "description": "Update category details",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager"]
      },
      "DELETE /api/menu/categories/:id": {
        "description": "Soft delete category (set is_active = false)",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager"]
      },
      "GET /api/menu/items": {
        "description": "Get all menu items with category information",
        "requires_auth": true,
        "query_params": {
          "category_id": "string (optional)",
          "active_only": "boolean (optional)",
          "available_only": "boolean (optional)"
        },
        "response": "Array of menu items with category details"
      },
      "POST /api/menu/items": {
        "description": "Create new menu item",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager"],
        "request_body": {
          "name": "string",
          "description": "string (optional)",
          "price": "number",
          "cost_price": "number (optional)",
          "category_id": "string (optional)",
          "track_inventory": "boolean",
          "inventory_item_id": "string (if track_inventory is true)"
        }
      },
      "PATCH /api/menu/items/:id": {
        "description": "Update menu item",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager"]
      },
      "DELETE /api/menu/items/:id": {
        "description": "Soft delete menu item (set is_active = false)",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager"]
      }
    },

    "orders": {
      "GET /api/orders": {
        "description": "Get orders with filtering and pagination",
        "requires_auth": true,
        "query_params": {
          "status": "pending|preparing|ready|completed|cancelled (optional)",
          "order_type": "dine_in|takeaway|delivery|bar_only (optional)",
          "start_date": "date YYYY-MM-DD (optional)",
          "end_date": "date YYYY-MM-DD (optional)",
          "limit": "number (default 100)",
          "offset": "number (default 0)"
        }
      },
      "GET /api/orders/:id": {
        "description": "Get single order with all items and payment details",
        "requires_auth": true,
        "response": {
          "order": "object",
          "items": "array of order_items",
          "payments": "array of payments"
        }
      },
      "POST /api/orders": {
        "description": "Create new order with items",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager", "cashier", "bar_staff"],
        "request_body": {
          "order_type": "dine_in|takeaway|delivery|bar_only",
          "table_number": "string (optional, required for dine_in)",
          "items": [
            {
              "menu_item_id": "string",
              "item_name": "string",
              "quantity": "number",
              "unit_price": "number",
              "notes": "string (optional)"
            }
          ],
          "discount_amount": "number (optional)",
          "notes": "string (optional)"
        },
        "logic": [
          "1. Generate unique order number using generate_order_number()",
          "2. Calculate subtotal from items: SUM(quantity * unit_price)",
          "3. Get VAT rate from restaurant_settings, calculate vat_amount",
          "4. Calculate service_charge if applicable (configurable)",
          "5. Calculate total_amount = subtotal + vat_amount + service_charge - discount_amount",
          "6. Insert order record",
          "7. Insert all order_items records",
          "8. For items with track_inventory = true, reduce inventory stock",
          "9. Create stock_movement record for each inventory change",
          "10. Return created order with items"
        ]
      },
      "PATCH /api/orders/:id": {
        "description": "Update order status",
        "requires_auth": true,
        "request_body": {
          "status": "pending|preparing|ready|completed|cancelled"
        },
        "logic": [
          "1. Validate order exists",
          "2. Update order status",
          "3. If cancelled, restore inventory stock if applicable"
        ]
      },
      "POST /api/orders/:id/payment": {
        "description": "Add payment to order and complete it",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager", "cashier"],
        "request_body": {
          "payment_method": "cash|card|transfer|mobile",
          "amount": "number",
          "reference": "string (optional, for card/transfer)"
        },
        "logic": [
          "1. Validate order exists and not already paid/completed",
          "2. Validate payment amount matches order total",
          "3. Create payment record",
          "4. Update order status to 'completed'",
          "5. Return payment confirmation with receipt data"
        ]
      },
      "GET /api/orders/kitchen": {
        "description": "Get kitchen display orders - food items only",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager", "kitchen_staff"],
        "logic": [
          "1. Get orders with status IN ('pending', 'preparing', 'ready')",
          "2. Filter to only include items from categories with category_type = 'food'",
          "3. Exclude orders with order_type = 'bar_only'",
          "4. Return orders sorted by created_at ascending (oldest first)"
        ]
      },
      "GET /api/orders/bar": {
        "description": "Get bar display orders - drink items only",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager", "bar_staff"],
        "logic": [
          "1. Get orders with status IN ('pending', 'preparing', 'ready')",
          "2. Filter to only include items from categories with category_type = 'drink'",
          "3. Include all order_types (including 'bar_only')",
          "4. Return orders sorted by created_at ascending (oldest first)"
        ]
      }
    },

    "inventory": {
      "GET /api/inventory": {
        "description": "Get all inventory items with optional filtering",
        "requires_auth": true,
        "query_params": {
          "category_id": "string (optional)",
          "supplier_id": "string (optional)",
          "low_stock_only": "boolean (optional)"
        }
      },
      "POST /api/inventory": {
        "description": "Create new inventory item",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager", "inventory_officer"],
        "request_body": {
          "name": "string",
          "category": "string (optional)",
          "category_id": "string (optional)",
          "unit": "string",
          "current_stock": "number",
          "min_stock_level": "number",
          "cost_per_unit": "number (optional)",
          "supplier_id": "string (optional)"
        }
      },
      "PATCH /api/inventory/:id": {
        "description": "Update inventory item details",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager", "inventory_officer"]
      },
      "DELETE /api/inventory/:id": {
        "description": "Soft delete inventory item",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager", "inventory_officer"]
      },
      "POST /api/inventory/:id/movement": {
        "description": "Record stock movement (in/out/adjustment)",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager", "inventory_officer"],
        "request_body": {
          "movement_type": "in|out|adjustment",
          "quantity": "number",
          "notes": "string (optional)"
        },
        "logic": [
          "1. Get current stock level",
          "2. Calculate new stock based on movement type:",
          "   - 'in': new_stock = current_stock + quantity",
          "   - 'out': new_stock = current_stock - quantity",
          "   - 'adjustment': new_stock = quantity (absolute value)",
          "3. Create stock_movements record with audit trail",
          "4. Update inventory_items.current_stock",
          "5. Return updated inventory item"
        ]
      },
      "GET /api/inventory/low-stock": {
        "description": "Get items below minimum stock level",
        "requires_auth": true,
        "sql": "SELECT * FROM inventory_items WHERE current_stock <= min_stock_level AND is_active = 1 ORDER BY (current_stock / min_stock_level) ASC"
      },
      "GET /api/inventory/movements": {
        "description": "Get stock movement history for auditing",
        "requires_auth": true,
        "query_params": {
          "inventory_item_id": "string (optional)",
          "movement_type": "in|out|adjustment (optional)",
          "start_date": "date (optional)",
          "end_date": "date (optional)"
        }
      }
    },

    "suppliers": {
      "GET /api/suppliers": {
        "description": "Get all suppliers",
        "requires_auth": true,
        "query_params": {
          "active_only": "boolean (optional)"
        }
      },
      "POST /api/suppliers": {
        "description": "Create new supplier",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager", "inventory_officer"],
        "request_body": {
          "name": "string",
          "contact_person": "string (optional)",
          "phone": "string (optional)",
          "email": "string (optional)",
          "address": "string (optional)",
          "notes": "string (optional)"
        }
      },
      "PATCH /api/suppliers/:id": {
        "description": "Update supplier details",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager", "inventory_officer"]
      },
      "DELETE /api/suppliers/:id": {
        "description": "Soft delete supplier (set is_active = false)",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager", "inventory_officer"]
      }
    },

    "staff": {
      "GET /api/staff": {
        "description": "Get all staff members with roles and profiles",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager"],
        "sql": "SELECT u.id, u.email, p.full_name, ur.role, p.created_at FROM users u JOIN profiles p ON u.id = p.id JOIN user_roles ur ON u.id = ur.user_id ORDER BY p.full_name"
      },
      "POST /api/staff": {
        "description": "Create new staff member account",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager"],
        "request_body": {
          "email": "string",
          "password": "string",
          "full_name": "string",
          "role": "super_admin|manager|cashier|bar_staff|kitchen_staff|inventory_officer|accountant"
        },
        "logic": [
          "1. Validate email doesn't exist",
          "2. Only super_admin can create another super_admin",
          "3. Hash password",
          "4. Create user, profile, and user_role records"
        ]
      },
      "PATCH /api/staff/:id": {
        "description": "Update staff member details (name, email)",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager"]
      },
      "DELETE /api/staff/:id": {
        "description": "Delete staff member account",
        "requires_auth": true,
        "allowed_roles": ["super_admin"],
        "logic": [
          "1. Cannot delete own account",
          "2. Cannot delete last super_admin",
          "3. Cascade delete removes profile and role"
        ]
      },
      "POST /api/staff/:id/reset-password": {
        "description": "Reset staff member's password",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager"],
        "request_body": {
          "new_password": "string"
        }
      },
      "PATCH /api/staff/:id/role": {
        "description": "Change staff member's role",
        "requires_auth": true,
        "allowed_roles": ["super_admin"],
        "request_body": {
          "role": "string"
        }
      }
    },

    "settings": {
      "GET /api/settings": {
        "description": "Get restaurant/business settings",
        "requires_auth": true,
        "response": {
          "name": "string",
          "tagline": "string",
          "address": "string",
          "city": "string",
          "country": "string",
          "phone": "string",
          "email": "string",
          "currency": "string",
          "timezone": "string",
          "vat_rate": "number",
          "service_charge_rate": "number",
          "receipt_footer": "string",
          "receipt_show_logo": "boolean",
          "logo_url": "string"
        }
      },
      "PATCH /api/settings": {
        "description": "Update restaurant/business settings",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager"]
      },
      "POST /api/settings/logo": {
        "description": "Upload business logo",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager"],
        "content_type": "multipart/form-data"
      }
    },

    "reports": {
      "GET /api/reports/sales": {
        "description": "Get comprehensive sales report",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager", "accountant"],
        "query_params": {
          "start_date": "date YYYY-MM-DD",
          "end_date": "date YYYY-MM-DD",
          "group_by": "day|week|month"
        },
        "response": {
          "total_revenue": "number",
          "total_orders": "number",
          "average_order_value": "number",
          "by_period": "array of {period, revenue, orders}",
          "by_order_type": "array of {type, revenue, orders}",
          "by_payment_method": "array of {method, total}",
          "top_items": "array of {item_name, quantity, revenue}"
        }
      },
      "GET /api/reports/eod": {
        "description": "End of day summary report",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager", "cashier"],
        "query_params": {
          "date": "date YYYY-MM-DD (default: today)"
        },
        "response": {
          "date": "string",
          "total_orders": "number",
          "completed_orders": "number",
          "cancelled_orders": "number",
          "total_revenue": "number",
          "orders_by_type": "object",
          "payments_by_method": "object",
          "top_selling_items": "array"
        }
      },
      "GET /api/reports/inventory": {
        "description": "Inventory status report",
        "requires_auth": true,
        "allowed_roles": ["super_admin", "manager", "inventory_officer"],
        "response": {
          "total_items": "number",
          "low_stock_count": "number",
          "out_of_stock_count": "number",
          "total_stock_value": "number",
          "low_stock_items": "array"
        }
      }
    }
  },

  "frontend_pages": {
    "/auth": {
      "description": "Login and authentication page",
      "components": ["LoginForm", "SignupForm (hidden by default, shown during initial setup)"],
      "features": [
        "Email/password login",
        "Remember me option",
        "Initialize system data button (first-time setup only)",
        "Responsive design for tablet/desktop use"
      ]
    },
    "/dashboard": {
      "description": "Main dashboard with key metrics and quick actions",
      "allowed_roles": ["super_admin", "manager"],
      "components": ["StatsCards", "RevenueChart", "RecentOrders", "LowStockAlert"],
      "stats": [
        "Today's revenue",
        "Total orders today",
        "Active menu items",
        "Low stock items count (with alert)"
      ]
    },
    "/pos": {
      "description": "Point of Sale terminal - main sales interface",
      "allowed_roles": ["super_admin", "manager", "cashier", "bar_staff"],
      "layout": {
        "left": "Menu grid with category tabs and search",
        "right": "Cart panel with order summary and checkout"
      },
      "features": [
        "Category filtering with tabs",
        "Search menu items by name",
        "Add/remove items from cart with one click",
        "Adjust item quantities",
        "Add notes to individual items",
        "Apply discounts (amount or percentage)",
        "Select order type (dine_in, takeaway, delivery, bar_only)",
        "Table number input for dine-in orders",
        "Order-level notes",
        "Checkout dialog with payment method selection",
        "Print receipt functionality",
        "Clear cart button"
      ]
    },
    "/kitchen": {
      "description": "Kitchen display system for food order tracking",
      "allowed_roles": ["super_admin", "manager", "kitchen_staff"],
      "features": [
        "View pending food orders in card layout",
        "Update order status (pending → preparing → ready)",
        "Real-time updates via polling (configurable interval)",
        "Order age/timer display",
        "Order details with item notes",
        "Audio notification for new orders (optional)"
      ],
      "filtering": "Shows only items from categories with category_type = 'food', excludes 'bar_only' orders"
    },
    "/bar": {
      "description": "Bar display system for drink order tracking",
      "allowed_roles": ["super_admin", "manager", "bar_staff"],
      "features": [
        "View pending drink orders",
        "Update order status",
        "Real-time updates",
        "Includes 'bar_only' order types"
      ],
      "filtering": "Shows only items from categories with category_type = 'drink'"
    },
    "/orders": {
      "description": "Order history and management",
      "allowed_roles": ["super_admin", "manager", "cashier"],
      "features": [
        "Filter by status, date range, order type",
        "Search by order number",
        "View order details in dialog",
        "Cancel pending orders",
        "Reprint receipts",
        "Pagination for large order lists"
      ]
    },
    "/menu": {
      "description": "Menu management interface",
      "allowed_roles": ["super_admin", "manager"],
      "tabs": ["Menu Items", "Categories"],
      "features": [
        "CRUD operations for menu items",
        "CRUD operations for categories",
        "Set and update prices",
        "Toggle item availability",
        "Assign categories to items",
        "Link menu items to inventory for automatic stock tracking",
        "Bulk actions (activate/deactivate)",
        "Reorder categories"
      ]
    },
    "/inventory": {
      "description": "Inventory and stock management",
      "allowed_roles": ["super_admin", "manager", "inventory_officer"],
      "tabs": ["Inventory Items", "Suppliers"],
      "features": [
        "CRUD inventory items",
        "Record stock movements (in/out/adjustment)",
        "Low stock alerts with visual indicators",
        "View stock movement history",
        "CRUD suppliers",
        "Link inventory items to suppliers",
        "Set minimum stock levels",
        "Export inventory report"
      ]
    },
    "/staff": {
      "description": "Staff and user management",
      "allowed_roles": ["super_admin", "manager"],
      "features": [
        "View all staff members",
        "Add new staff with role assignment",
        "Edit staff details",
        "Change user roles (super_admin only)",
        "Reset staff passwords",
        "Deactivate/delete staff accounts"
      ]
    },
    "/reports": {
      "description": "Sales and business reports",
      "allowed_roles": ["super_admin", "manager", "accountant"],
      "features": [
        "Date range selection with presets",
        "Revenue charts (daily/weekly/monthly)",
        "Sales breakdown by order type",
        "Payment method distribution",
        "Top selling items chart",
        "Export to CSV",
        "Print report"
      ]
    },
    "/eod-report": {
      "description": "End of day shift report",
      "allowed_roles": ["super_admin", "manager", "cashier"],
      "features": [
        "Select date for report",
        "Daily summary statistics",
        "Orders breakdown by status",
        "Payment methods breakdown",
        "Print EOD report"
      ]
    },
    "/settings": {
      "description": "Business configuration",
      "allowed_roles": ["super_admin", "manager"],
      "features": [
        "Update business name and tagline",
        "Set address and contact details",
        "Currency and timezone settings",
        "VAT and service charge rates",
        "Receipt customization (footer text, logo toggle)",
        "Upload business logo"
      ]
    },
    "/profile": {
      "description": "User profile page",
      "allowed_roles": "all authenticated users",
      "features": [
        "View profile information",
        "Change own password",
        "View assigned role"
      ]
    }
  },

  "role_permissions": {
    "super_admin": {
      "description": "Full system access - owner/administrator",
      "can_access": ["all pages"],
      "special_abilities": [
        "Create and delete any staff account",
        "Change any user's role",
        "Access all reports and data",
        "Modify all system settings",
        "Delete orders"
      ]
    },
    "manager": {
      "description": "Management access - shift manager/supervisor",
      "can_access": ["dashboard", "pos", "kitchen", "bar", "orders", "menu", "inventory", "staff", "reports", "eod-report", "settings", "profile"],
      "can_do": [
        "Create staff (except super_admin)",
        "Reset passwords",
        "Manage menu and inventory",
        "View all reports"
      ],
      "cannot": [
        "Delete staff accounts",
        "Change super_admin roles",
        "Delete orders"
      ]
    },
    "cashier": {
      "description": "Sales operations - front counter staff",
      "can_access": ["pos", "orders", "eod-report", "profile"],
      "can_do": [
        "Create orders",
        "Process payments",
        "View order history",
        "Print receipts",
        "Generate EOD reports"
      ]
    },
    "bar_staff": {
      "description": "Bar operations - bartender",
      "can_access": ["pos", "bar", "profile"],
      "can_do": [
        "Create bar orders",
        "Update drink order status",
        "View bar orders"
      ]
    },
    "kitchen_staff": {
      "description": "Kitchen operations - cook/chef",
      "can_access": ["kitchen", "profile"],
      "can_do": [
        "View food orders",
        "Update food order status"
      ]
    },
    "inventory_officer": {
      "description": "Inventory management - stock keeper",
      "can_access": ["inventory", "profile"],
      "can_do": [
        "Manage inventory items",
        "Record stock movements",
        "Manage suppliers",
        "View inventory reports"
      ]
    },
    "accountant": {
      "description": "Financial reporting - bookkeeper",
      "can_access": ["reports", "profile"],
      "can_do": [
        "View all financial reports",
        "Export data for accounting"
      ]
    }
  },

  "business_logic": {
    "order_number_generation": {
      "format": "ORD-YYYYMMDD-XXXX",
      "example": "ORD-20251226-0001",
      "implementation": "Use date prefix + random/sequential 4-digit number"
    },
    "pricing_calculations": {
      "subtotal": "SUM(quantity * unit_price) for all order items",
      "vat_rate": "Configurable in settings (default 7.5% = 0.075)",
      "vat_amount": "subtotal * vat_rate",
      "service_charge_rate": "Configurable in settings (default 10% = 0.10)",
      "service_charge": "Optional, typically for dine_in: subtotal * service_charge_rate",
      "total_amount": "subtotal + vat_amount + service_charge - discount_amount"
    },
    "inventory_tracking": {
      "on_order_create": "If menu_item.track_inventory = true, reduce linked inventory_item.current_stock by ordered quantity",
      "on_order_cancel": "If order had inventory items, restore stock by cancelled quantities",
      "low_stock_alert": "Triggered when current_stock <= min_stock_level",
      "stock_movement_audit": "Every stock change creates a stock_movements record"
    },
    "receipt_data": {
      "header": [
        "Business name",
        "Tagline",
        "Address (line 1, line 2)",
        "Phone number",
        "Email"
      ],
      "body": [
        "Order number",
        "Date and time",
        "Order type (Dine-in/Takeaway/Delivery/Bar)",
        "Table number (if dine-in)",
        "Items list with quantities and prices",
        "Subtotal",
        "VAT amount",
        "Service charge (if applicable)",
        "Discount (if applied)",
        "Total amount"
      ],
      "footer": [
        "Payment method used",
        "Custom footer text from settings",
        "Business logo (optional)"
      ]
    },
    "kitchen_bar_filtering": {
      "kitchen_display": "Shows orders containing items from 'food' category_type, excludes 'bar_only' order_type",
      "bar_display": "Shows orders containing items from 'drink' category_type, includes all order types"
    }
  },

  "php_implementation_hints": {
    "folder_structure": {
      "root": [
        "index.php (main entry point / router)",
        "config/",
        "api/",
        "classes/",
        "middleware/",
        "public/ (static assets)",
        "uploads/ (logo and images)"
      ],
      "config": [
        "database.php (MySQL connection settings)",
        "jwt.php (JWT secret and expiry settings)",
        "app.php (general app configuration)"
      ],
      "api": [
        "index.php (API router)",
        "auth.php",
        "menu.php",
        "orders.php",
        "inventory.php",
        "suppliers.php",
        "staff.php",
        "settings.php",
        "reports.php"
      ],
      "classes": [
        "Database.php (PDO wrapper with connection pooling)",
        "JWT.php (token generation and validation)",
        "User.php",
        "Order.php",
        "MenuItem.php",
        "Inventory.php",
        "Response.php (JSON response helper)"
      ],
      "middleware": [
        "AuthMiddleware.php (JWT validation)",
        "RoleMiddleware.php (permission checking)",
        "CorsMiddleware.php (if using separate frontend)"
      ]
    },
    "recommended_libraries": {
      "jwt": "firebase/php-jwt (composer require firebase/php-jwt)",
      "routing": "nikic/fast-route or simple .htaccess routing",
      "validation": "respect/validation (optional)",
      "uuid": "ramsey/uuid (composer require ramsey/uuid)",
      "pdf": "tecnickcom/tcpdf or dompdf/dompdf (for PDF receipts)"
    },
    "htaccess_for_api": {
      "description": "Place in /api folder for clean URLs",
      "content": "RewriteEngine On\nRewriteCond %{REQUEST_FILENAME} !-f\nRewriteCond %{REQUEST_FILENAME} !-d\nRewriteRule ^(.*)$ index.php?route=$1 [QSA,L]"
    },
    "security_checklist": [
      "Use PDO with prepared statements for ALL database queries",
      "Hash passwords with password_hash() using PASSWORD_DEFAULT",
      "Verify passwords with password_verify()",
      "Validate and sanitize all user inputs",
      "Use HTTPS in production",
      "Implement rate limiting on login endpoint",
      "Set secure and httpOnly flags on cookies",
      "Validate JWT on every protected API route",
      "Check user roles/permissions before sensitive operations",
      "Implement CSRF protection if using sessions",
      "Set appropriate CORS headers"
    ],
    "database_connection_example": {
      "php": "<?php\nclass Database {\n    private static $instance = null;\n    private $conn;\n    \n    private function __construct() {\n        $host = 'localhost';\n        $db = 'iloungepos';\n        $user = 'root';\n        $pass = '';\n        $charset = 'utf8mb4';\n        \n        $dsn = \"mysql:host=$host;dbname=$db;charset=$charset\";\n        $options = [\n            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\n            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\n            PDO::ATTR_EMULATE_PREPARES => false,\n        ];\n        \n        $this->conn = new PDO($dsn, $user, $pass, $options);\n    }\n    \n    public static function getInstance() {\n        if (self::$instance === null) {\n            self::$instance = new self();\n        }\n        return self::$instance;\n    }\n    \n    public function getConnection() {\n        return $this->conn;\n    }\n}"
    }
  },

  "sample_data": {
    "default_admin": {
      "email": "admin@iloungepos.local",
      "password": "admin123",
      "full_name": "System Administrator",
      "role": "super_admin",
      "note": "Change password immediately after first login"
    },
    "sample_staff": [
      { "email": "manager@iloungepos.local", "password": "manager123", "full_name": "Manager User", "role": "manager" },
      { "email": "cashier@iloungepos.local", "password": "cashier123", "full_name": "Cashier User", "role": "cashier" },
      { "email": "kitchen@iloungepos.local", "password": "kitchen123", "full_name": "Kitchen Staff", "role": "kitchen_staff" },
      { "email": "bar@iloungepos.local", "password": "bar123", "full_name": "Bar Staff", "role": "bar_staff" }
    ],
    "sample_categories": [
      { "name": "Appetizers", "category_type": "food", "sort_order": 1 },
      { "name": "Main Course", "category_type": "food", "sort_order": 2 },
      { "name": "Desserts", "category_type": "food", "sort_order": 3 },
      { "name": "Sides", "category_type": "food", "sort_order": 4 },
      { "name": "Soft Drinks", "category_type": "drink", "sort_order": 5 },
      { "name": "Hot Beverages", "category_type": "drink", "sort_order": 6 },
      { "name": "Alcoholic Beverages", "category_type": "drink", "sort_order": 7 },
      { "name": "Cocktails", "category_type": "drink", "sort_order": 8 }
    ],
    "sample_menu_items": [
      { "name": "Spring Rolls", "price": 500, "category": "Appetizers" },
      { "name": "Chicken Wings", "price": 800, "category": "Appetizers" },
      { "name": "Grilled Chicken", "price": 2500, "category": "Main Course" },
      { "name": "Beef Steak", "price": 4500, "category": "Main Course" },
      { "name": "Pasta Carbonara", "price": 2000, "category": "Main Course" },
      { "name": "French Fries", "price": 500, "category": "Sides" },
      { "name": "Coleslaw", "price": 300, "category": "Sides" },
      { "name": "Ice Cream", "price": 600, "category": "Desserts" },
      { "name": "Coca Cola", "price": 300, "category": "Soft Drinks" },
      { "name": "Fresh Juice", "price": 500, "category": "Soft Drinks" },
      { "name": "Coffee", "price": 400, "category": "Hot Beverages" },
      { "name": "Beer", "price": 800, "category": "Alcoholic Beverages" },
      { "name": "Mojito", "price": 1500, "category": "Cocktails" }
    ],
    "default_settings": {
      "name": "My Restaurant",
      "tagline": "Powered by iloungePOS",
      "currency": "USD",
      "vat_rate": 0.075,
      "service_charge_rate": 0.10,
      "receipt_footer": "Thank you for your patronage!"
    }
  },

  "deployment_notes": {
    "wamp_xampp_setup": [
      "1. Download and install WAMP (Windows) or XAMPP (Windows/Linux/Mac)",
      "2. Start Apache and MySQL services",
      "3. Copy project folder to www (WAMP) or htdocs (XAMPP) directory",
      "4. Open phpMyAdmin (http://localhost/phpmyadmin)",
      "5. Create new database named 'iloungepos'",
      "6. Import schema.sql to create all tables",
      "7. Update config/database.php with your credentials",
      "8. Access application at http://localhost/iloungepos",
      "9. Login with default admin credentials",
      "10. Change default password immediately"
    ],
    "linux_lamp_setup": [
      "1. Install LAMP stack: sudo apt install apache2 mysql-server php php-mysql",
      "2. Enable mod_rewrite: sudo a2enmod rewrite",
      "3. Copy project to /var/www/html/iloungepos",
      "4. Set permissions: sudo chown -R www-data:www-data /var/www/html/iloungepos",
      "5. Create database and import schema",
      "6. Configure Apache virtual host if needed",
      "7. Access and configure"
    ],
    "environment_config": {
      "development": {
        "display_errors": true,
        "error_reporting": "E_ALL",
        "jwt_secret": "dev-secret-change-in-production",
        "jwt_expiry": "24 hours"
      },
      "production": {
        "display_errors": false,
        "error_reporting": 0,
        "jwt_secret": "generate-strong-random-secret-minimum-32-chars",
        "jwt_expiry": "8 hours",
        "force_https": true
      }
    },
    "maintenance": {
      "backup": "Regular MySQL dumps of iloungepos database",
      "logs": "Rotate PHP error logs periodically",
      "updates": "Test updates in staging before production deployment"
    }
  }
}
